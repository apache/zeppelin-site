
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Apache Zeppelin 0.7.0 Documentation: Livy Interpreter for Apache Zeppelin</title>
    <meta name="description" content="Livy is an open source REST interface for interacting with Spark from anywhere. It supports executing snippets of code or programs in a Spark context that runs locally or in YARN.">
    <meta name="author" content="The Apache Software Foundation">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Le styles -->
    <link href="/docs/0.7.0/assets/themes/zeppelin/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="/docs/0.7.0/assets/themes/zeppelin/css/style.css?body=1" rel="stylesheet" type="text/css">
    <link href="/docs/0.7.0/assets/themes/zeppelin/css/syntax.css" rel="stylesheet"  type="text/css" media="screen" /> 
    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- Js -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/bootstrap/js/bootstrap.min.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/js/docs.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/js/anchor.min.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/js/toc.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/js/lunr.min.js"></script>
    <script src="/docs/0.7.0/assets/themes/zeppelin/js/search.js"></script>    

    <!-- atom & rss feed -->
    <link href="/docs/0.7.0/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/docs/0.7.0/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
  </head>

  <body>
    
        <div id="menu" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/docs/0.7.0">
            <img src="/assets/themes/zeppelin/img/zeppelin_logo.png" width="50" alt="I'm zeppelin">
            <span style="vertical-align:middle">Zeppelin</span>
            <span style="vertical-align:baseline"><small>0.7.0</small></span>
          </a>
        </div>
        <nav class="navbar-collapse collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Quick Start <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/docs/0.7.0/index.html">What is Apache Zeppelin ?</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Getting Started</b><span></li>
                <li><a href="/docs/0.7.0/install/install.html">Install</a></li>
                <li><a href="/docs/0.7.0/install/configuration.html">Configuration</a></li>
                <li><a href="/docs/0.7.0/quickstart/explorezeppelinui.html">Explore Zeppelin UI</a></li>
                <li><a href="/docs/0.7.0/quickstart/tutorial.html">Tutorial</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Basic Feature Guide</b><span></li>
                <li><a href="/docs/0.7.0/manual/dynamicform.html">Dynamic Form</a></li>
                <li><a href="/docs/0.7.0/manual/publish.html">Publish your Paragraph</a></li>
                <li><a href="/docs/0.7.0/manual/notebookashomepage.html">Customize Zeppelin Homepage</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>More</b><span></li>
                <li><a href="/docs/0.7.0/install/upgrade.html">Upgrade Zeppelin Version</a></li>
                <li><a href="/docs/0.7.0/install/build.html">Build from source</a></li>
                <li><a href="/docs/0.7.0/quickstart/install_with_flink_and_spark_cluster.html">Install Zeppelin with Flink and Spark Clusters Tutorial</a></li>
              </ul>
            </li>
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Interpreter <b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu">
                <li><a href="/docs/0.7.0/manual/interpreters.html">Overview</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Usage</b><span></li>
                <li><a href="/docs/0.7.0/manual/interpreterinstallation.html">Interpreter Installation</a></li>
                <!--<li><a href="/docs/0.7.0/manual/dynamicinterpreterload.html">Dynamic Interpreter Loading</a></li>-->
                <li><a href="/docs/0.7.0/manual/dependencymanagement.html">Interpreter Dependency Management</a></li>
                <li><a href="/docs/0.7.0/manual/userimpersonation.html">Interpreter User Impersonation</a></li>
                <li><a href="/docs/0.7.0/manual/interpreterexechooks.html">Interpreter Execution Hooks (Experimental)</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Available Interpreters</b><span></li>
                <li><a href="/docs/0.7.0/interpreter/alluxio.html">Alluxio</a></li>
                <li><a href="/docs/0.7.0/interpreter/beam.html">Beam</a></li>
                <li><a href="/docs/0.7.0/interpreter/bigquery.html">BigQuery</a></li>
                <li><a href="/docs/0.7.0/interpreter/cassandra.html">Cassandra</a></li>
                <li><a href="/docs/0.7.0/interpreter/elasticsearch.html">Elasticsearch</a></li>
                <li><a href="/docs/0.7.0/interpreter/flink.html">Flink</a></li>
                <li><a href="/docs/0.7.0/interpreter/geode.html">Geode</a></li>
                <li><a href="/docs/0.7.0/interpreter/hbase.html">HBase</a></li>
                <li><a href="/docs/0.7.0/interpreter/hdfs.html">HDFS</a></li>
                <li><a href="/docs/0.7.0/interpreter/hive.html">Hive</a></li>
                <li><a href="/docs/0.7.0/interpreter/ignite.html">Ignite</a></li>
                <li><a href="/docs/0.7.0/interpreter/jdbc.html">JDBC</a></li>
                <li><a href="/docs/0.7.0/interpreter/kylin.html">Kylin</a></li>
                <li><a href="/docs/0.7.0/interpreter/lens.html">Lens</a></li>
                <li><a href="/docs/0.7.0/interpreter/livy.html">Livy</a></li>
                <li><a href="/docs/0.7.0/interpreter/markdown.html">Markdown</a></li>
                <li><a href="/docs/0.7.0/interpreter/pig.html">Pig</a></li>
                <li><a href="/docs/0.7.0/interpreter/python.html">Python</a></li>
                <li><a href="/docs/0.7.0/interpreter/postgresql.html">Postgresql, HAWQ</a></li>
                <li><a href="/docs/0.7.0/interpreter/r.html">R</a></li>
                <li><a href="/docs/0.7.0/interpreter/scalding.html">Scalding</a></li>
                <li><a href="/docs/0.7.0/interpreter/scio.html">Scio</a></li>
                <li><a href="/docs/0.7.0/interpreter/shell.html">Shell</a></li>
                <li><a href="/docs/0.7.0/interpreter/spark.html">Spark</a></li>
              </ul>
            </li>
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">Display System <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="title"><span><b>Basic Display System</b><span></li>
                <li><a href="/docs/0.7.0/displaysystem/basicdisplaysystem.html#text">Text</a></li>
                <li><a href="/docs/0.7.0/displaysystem/basicdisplaysystem.html#html">Html</a></li>
                <li><a href="/docs/0.7.0/displaysystem/basicdisplaysystem.html#table">Table</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Angular API</b><span></li>
                <li><a href="/docs/0.7.0/displaysystem/back-end-angular.html">Angular (backend API)</a></li>
                <li><a href="/docs/0.7.0/displaysystem/front-end-angular.html">Angular (frontend API)</a></li>
              </ul>
            </li>
            <li>
              <a href="#" data-toggle="dropdown" class="dropdown-toggle">More<b class="caret"></b></a>
              <ul class="dropdown-menu scrollable-menu" style="right: 0; left: auto;">
                <li class="title"><span><b>Notebook Storage</b><span></li>
                <li><a href="/docs/0.7.0/storage/storage.html#notebook-storage-in-local-git-repository">Git Storage</a></li>
                <li><a href="/docs/0.7.0/storage/storage.html#notebook-storage-in-s3">S3 Storage</a></li>
                <li><a href="/docs/0.7.0/storage/storage.html#notebook-storage-in-azure">Azure Storage</a></li>
                <li><a href="/docs/0.7.0/storage/storage.html#storage-in-zeppelinhub">ZeppelinHub Storage</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>REST API</b><span></li>
                <li><a href="/docs/0.7.0/rest-api/rest-interpreter.html">Interpreter API</a></li>
                <li><a href="/docs/0.7.0/rest-api/rest-notebook.html">Notebook API</a></li>
                <li><a href="/docs/0.7.0/rest-api/rest-configuration.html">Configuration API</a></li>
                <li><a href="/docs/0.7.0/rest-api/rest-credential.html">Credential API</a></li>
                <li><a href="/docs/0.7.0/rest-api/rest-helium.html">Helium API</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Security</b><span></li>
                <li><a href="/docs/0.7.0/security/shiroauthentication.html">Shiro Authentication</a></li>                
                <li><a href="/docs/0.7.0/security/notebook_authorization.html">Notebook Authorization</a></li>
                <li><a href="/docs/0.7.0/security/datasource_authorization.html">Data Source Authorization</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Advanced</b><span></li>
                <li><a href="/docs/0.7.0/install/virtual_machine.html">Zeppelin on Vagrant VM</a></li>
                <li><a href="/docs/0.7.0/install/spark_cluster_mode.html#spark-standalone-mode">Zeppelin on Spark Cluster Mode (Standalone)</a></li>
                <li><a href="/docs/0.7.0/install/spark_cluster_mode.html#spark-on-yarn-mode">Zeppelin on Spark Cluster Mode (YARN)</a></li>
                <li><a href="/docs/0.7.0/install/spark_cluster_mode.html#spark-on-mesos-mode">Zeppelin on Spark Cluster Mode (Mesos)</a></li>
                <li><a href="/docs/0.7.0/install/cdh.html">Zeppelin on CDH</a></li>
                <li role="separator" class="divider"></li>
                <li class="title"><span><b>Contibute</b><span></li>
                <li><a href="/docs/0.7.0/development/writingzeppelininterpreter.html">Writing Zeppelin Interpreter</a></li>
                <li><a href="/docs/0.7.0/development/writingzeppelinvisualization.html">Writing Zeppelin Visualization (Experimental)</a></li>
                <li><a href="/docs/0.7.0/development/writingzeppelinapplication.html">Writing Zeppelin Application (Experimental)</a></li>
                <li><a href="/docs/0.7.0/development/howtocontribute.html">How to contribute (code)</a></li>
                <li><a href="/docs/0.7.0/development/howtocontributewebsite.html">How to contribute (website)</a></li>
              </ul>
            </li>
            <li>
              <a href="/docs/0.7.0/search.html" class="nav-search-link">
                <span class="fa fa-search nav-search-icon"></span>
              </a>
            </li>
          </ul>
        </nav><!--/.navbar-collapse -->
      </div>
    </div>



    <div class="content">
      
<!--<div class="hero-unit Livy Interpreter for Apache Zeppelin">
  <h1></h1>
</div>
-->

<div class="row">
  <div class="col-md-12">
    <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1>Livy Interpreter for Apache Zeppelin</h1>

<div id="toc"></div>

<h2>Overview</h2>

<p><a href="http://livy.io/">Livy</a> is an open source REST interface for interacting with Spark from anywhere. It supports executing snippets of code or programs in a Spark context that runs locally or in YARN.</p>

<ul>
<li>Interactive Scala, Python and R shells</li>
<li>Batch submissions in Scala, Java, Python</li>
<li>Multi users can share the same server (impersonation support)</li>
<li>Can be used for submitting jobs from anywhere with REST</li>
<li>Does not require any code change to your programs</li>
</ul>

<h3>Requirements</h3>

<p>Additional requirements for the Livy interpreter are:</p>

<ul>
<li>Spark 1.3 or above.</li>
<li>Livy server.</li>
</ul>

<h2>Configuration</h2>

<p>We added some common configurations for spark, and you can set any configuration you want.
You can find all Spark configurations in <a href="http://spark.apache.org/docs/latest/configuration.html#available-properties">here</a>.
And instead of starting property with <code>spark.</code> it should be replaced with <code>livy.spark.</code>.
Example: <code>spark.driver.memory</code> to <code>livy.spark.driver.memory</code></p>

<table class="table-configuration">
  <tr>
    <th>Property</th>
    <th>Default</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>zeppelin.livy.url</td>
    <td>http://localhost:8998</td>
    <td>URL where livy server is running</td>
  </tr>
  <tr>
    <td>zeppelin.livy.spark.maxResult</td>
    <td>1000</td>
    <td>Max number of Spark SQL result to display.</td>
  </tr>
  <tr>
    <td>zeppelin.livy.session.create_timeout</td>
    <td>120</td>
    <td>Timeout in seconds for session creation</td>
  </tr>
  <tr>
    <td>zeppelin.livy.displayAppInfo</td>
    <td>false</td>
    <td>Whether to display app info</td>
  </tr>
  <tr>
    <td>zeppelin.livy.pull_status.interval.millis</td>
    <td>1000</td>
    <td>The interval for checking paragraph execution status</td>
  </tr>
  <tr>
    <td>livy.spark.driver.cores</td>
    <td></td>
    <td>Driver cores. ex) 1, 2.</td>
  </tr>
    <tr>
    <td>livy.spark.driver.memory</td>
    <td></td>
    <td>Driver memory. ex) 512m, 32g.</td>
  </tr>
    <tr>
    <td>livy.spark.executor.instances</td>
    <td></td>
    <td>Executor instances. ex) 1, 4.</td>
  </tr>
    <tr>
    <td>livy.spark.executor.cores</td>
    <td></td>
    <td>Num cores per executor. ex) 1, 4.</td>
  </tr>
  <tr>
    <td>livy.spark.executor.memory</td>
    <td></td>
    <td>Executor memory per worker instance. ex) 512m, 32g.</td>
  </tr>
  <tr>
    <td>livy.spark.dynamicAllocation.enabled</td>
    <td></td>
    <td>Use dynamic resource allocation. ex) True, False.</td>
  </tr>
  <tr>
    <td>livy.spark.dynamicAllocation.cachedExecutorIdleTimeout</td>
    <td></td>
    <td>Remove an executor which has cached data blocks.</td>
  </tr>
  <tr>
    <td>livy.spark.dynamicAllocation.minExecutors</td>
    <td></td>
    <td>Lower bound for the number of executors.</td>
  </tr>
  <tr>
    <td>livy.spark.dynamicAllocation.initialExecutors</td>
    <td></td>
    <td>Initial number of executors to run.</td>
  </tr>
  <tr>
    <td>livy.spark.dynamicAllocation.maxExecutors</td>
    <td></td>
    <td>Upper bound for the number of executors.</td>
  </tr>
    <tr>
      <td>livy.spark.jars.packages</td>
      <td></td>
      <td>Adding extra libraries to livy interpreter</td>
    </tr>
</table>

<p><strong>We remove livy.spark.master in zeppelin-0.7. Because we sugguest user to use livy 0.3 in zeppelin-0.7. And livy 0.3 don&#39;t allow to specify livy.spark.master, it enfornce yarn-cluster mode.</strong></p>

<h2>Adding External libraries</h2>

<p>You can load dynamic library to livy interpreter by set <code>livy.spark.jars.packages</code> property to comma-separated list of maven coordinates of jars to include on the driver and executor classpaths. The format for the coordinates should be groupId:artifactId:version. </p>

<p>Example</p>

<table class="table-configuration">
  <tr>
    <th>Property</th>
    <th>Example</th>
    <th>Description</th>
  </tr>
  <tr>
      <td>livy.spark.jars.packages</td>
      <td>io.spray:spray-json_2.10:1.3.1</td>
      <td>Adding extra libraries to livy interpreter</td>
    </tr>
  </table>
  

<h2>How to use</h2>

<p>Basically, you can use</p>

<p><strong>spark</strong></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">%livy.spark
sc.version
</code></pre></div>
<p><strong>pyspark</strong></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">%livy.pyspark
print &quot;1&quot;
</code></pre></div>
<p><strong>sparkR</strong></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">%livy.sparkr
hello &lt;- function( name ) {
    sprintf( &quot;Hello, %s&quot;, name );
}

hello(&quot;livy&quot;)
</code></pre></div>
<h2>Impersonation</h2>

<p>When Zeppelin server is running with authentication enabled, then this interpreter utilizes Livy’s user impersonation feature i.e. sends extra parameter for creating and running a session (&quot;proxyUser&quot;: &quot;${loggedInUser}&quot;). This is particularly useful when multi users are sharing a Notebook server.</p>

<h2>Apply Zeppelin Dynamic Forms</h2>

<p>You can leverage <a href="../manual/dynamicform.html">Zeppelin Dynamic Form</a>. You can use both the <code>text input</code> and <code>select form</code> parameterization features.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">%livy.pyspark
print &quot;${group_by=product_id,product_id|product_name|customer_id|store_id}&quot;
</code></pre></div>
<h2>FAQ</h2>

<p>Livy debugging: If you see any of these in error console</p>

<blockquote>
<p>Connect to livyhost:8998 [livyhost/127.0.0.1, livyhost/0:0:0:0:0:0:0:1] failed: Connection refused</p>
</blockquote>

<p>Looks like the livy server is not up yet or the config is wrong</p>

<blockquote>
<p>Exception: Session not found, Livy server would have restarted, or lost session.</p>
</blockquote>

<p>The session would have timed out, you may need to restart the interpreter.</p>

<blockquote>
<p>Blacklisted configuration values in session config: spark.master</p>
</blockquote>

<p>Edit <code>conf/spark-blacklist.conf</code> file in livy server and comment out <code>#spark.master</code> line.</p>

<p>If you choose to work on livy in <code>apps/spark/java</code> directory in <a href="https://github.com/cloudera/hue">https://github.com/cloudera/hue</a>,
copy <code>spark-user-configurable-options.template</code> to <code>spark-user-configurable-options.conf</code> file in livy server and comment out <code>#spark.master</code>. </p>

  </div>
</div>


      <hr>
      <footer>
        <!-- <p>&copy; 2017 The Apache Software Foundation</p>-->
      </footer>
    </div>

    


  <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45176241-5', 'zeppelin.apache.org');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');

</script>



  </body>
</html>

